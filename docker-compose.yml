web:
    image: shaneburkhart/construction-vr-demo
    ports:
        - "3000:4567"
    links:
        - pg
        - redis
    volumes:
        - .:/app
        - /app/node_modules
    env_file:
        - user.env
    command: "rerun --background --ignore 'build/*' ruby server.rb"

#react_build:
    #image: shaneburkhart/construction-vr-demo
    #volumes:
        #- .:/app
        #- /app/node_modules
    #env_file:
        #- user.env
    #command: "rerun --background --ignore 'build/*' --ignore 'public/finishes-app.js' make build_react"

web_prod:
    image: shaneburkhart/construction-vr-demo
    ports:
        - "4567:4567"
    links:
        - pg
        - redis
    env_file:
        - user.env
    command: "ruby server.rb"

pg:
    image: postgres
    ports:
        - "5432:5432"
    environment:
        - POSTGRES_USER=postgres
        - POSTGRES_PASSWORD=postgres
        - POSTGRES_DB=mydb
    volumes:
        - ./data/pg:/var/lib/postgresql/data

testing_worker:
    image: shaneburkhart/construction-vr-demo
    volumes:
        - .:/app
    env_file:
        - user.env
    command: "ruby workers/skp_model_tester.rb"

notification_worker:
    image: shaneburkhart/construction-vr-demo
    volumes:
        - .:/app
    env_file:
        - user.env
    command: "ruby workers/skp_rendering_notification.rb"

redis:
    image: redis:3.2
